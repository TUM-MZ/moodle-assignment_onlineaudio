define(["jquery","assignsubmission_onlineaudio/recordmp3"],function(a,b){"use strict";var c,d={init:function(c,e,f){function g(b){function e(){a("#state").on("click",function(b){var e=a(this);b.preventDefault(),f.record(),d.setState("recording"),e.off("click").on("click",function(b){b.preventDefault(),d.setState("converting"),e.text("Coverting to mp3, please wait..."),e.prop("disabled",!0),f.stop(),f.getMP3Blob(function(b){var f=URL.createObjectURL(b);d.setState("submit"),e.off("click").text("Submit").prop("disabled",!1).on("click",function(d){d.preventDefault(),e.prop("disabled",!0).text("Uploading...");var f=new FileReader;f.onload=function(b){var d=new FormData,f=encodeURIComponent("audio_recording_"+(new Date).getTime()+".mp3");d.append("fname",f),d.append("assignment_file",b.target.result),a.ajax({type:"POST",url:c,data:d,processData:!1,contentType:!1}).done(function(a){e.text("Uploaded"),location.reload()})},f.readAsDataURL(b)}),a("#download").attr("href",f).attr("download","recorded.mp3").html("Download Ready"),a("#audioplayer").attr("src",f),a("#audiopreview").css("display","flex")})})}),d.setState("start")}var f=new h(b);a("#reset").on("click",function(b){b.preventDefault(),a("#state").off("click"),f.reset(),e(),a("#download").attr("href","#"),a("#audioplayer").attr("src",""),a("#audiopreview").hide()}),e()}b.init(c);var h=b.Recorder;a("#audiopreview").hide(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0},g,function(a){console.error("No live audio present: "+a)})},setState:function(b){var d=a("#state"),e={start:function(){d.text("Start recording").removeClass().addClass("start")},recording:function(){var a=0;d.removeClass().addClass("recording");var b=function(){var b=Math.floor(a/60),c=("0"+a%60).slice(-2);d.text("Recording ("+b+":"+c+")...click to stop")};b(),c=setInterval(function(){++a,b()},1e3)},converting:function(){clearInterval(c),d.removeClass().addClass("converting").text("Coverting to mp3...please wait").prop("disabled",!0)},submit:function(){d.removeClass().addClass("submit").text("Submit").prop("disabled",!1)}};e[b]()}};return d});