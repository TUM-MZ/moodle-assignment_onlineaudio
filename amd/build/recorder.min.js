define(["jquery","assignsubmission_onlineaudio/recordmp3"],function(a,b){"use strict";var c={init:function(c,d,e){function f(b){function d(){a("#state").on("click",function(b){var d=a(this);console.log("start recording"),b.preventDefault(),e.record();var f=0,g=function(){var a=Math.floor(f/60),b=("0"+f%60).slice(-2);d.text("Recording ("+a+":"+b+")...click to stop")};g();var h=setInterval(function(){++f,g()},1e3);d.off("click").on("click",function(b){b.preventDefault(),clearInterval(h),console.log("stop recording"),d.text("Coverting to mp3, please wait..."),d.prop("disabled",!0),e.stop(),e.getMP3Blob(function(b){var e=URL.createObjectURL(b);d.off("click").text("Submit").prop("disabled",!1).on("click",function(e){e.preventDefault(),d.prop("disabled",!0).text("Uploading...");var f=new FileReader;f.onload=function(b){var e=new FormData,f=encodeURIComponent("audio_recording_"+(new Date).getTime()+".mp3");console.log("mp3name = "+f),e.append("fname",f),e.append("assignment_file",b.target.result),a.ajax({type:"POST",url:c,data:e,processData:!1,contentType:!1}).done(function(a){d.text("Uploaded"),location.reload(),console.log("uploaded data, "+a)})},f.readAsDataURL(b)}),a("#download").attr("href",e).attr("download","recorded.mp3").html("Download Ready"),a("#audioplayer").attr("src",e),a("#audiopreview").css("display","flex")})})}).text("Start recording")}var e=new g(b);a("#reset").on("click",function(b){b.preventDefault(),a("#state").off("click"),e.reset(),d(),a("#download").attr("href","#"),a("#audioplayer").attr("src",""),a("#audiopreview").hide()}),d()}b.init(c);var g=b.Recorder;a("#audiopreview").hide(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0},f,function(a){console.log("No live audio present: "+a)})}};return c});